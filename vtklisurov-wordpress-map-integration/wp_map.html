<!DOCTYPE html >
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Wordpress map</title>
    <style>
     #map {
        height: 850px;
	      width: 100%;
        margin-left: 150px;
      }
      html, body {
        height: 100%;
	      width: 100%;
        margin: 0;
        padding: 0;
      }

form {
  margin: auto;
  width: 350px;
  padding: 1em;
  border: 0px solid #CCC;
  border-radius: 1em;
}

form div + div {
  margin-top: 1em;
}

label {
  display: inline-block;
  width: 250px;
  text-align: left;
}

input, textarea {
  font: 1em sans-serif;
  width: 300px;
  box-sizing: border-box;
  border: 1px solid #999;
}

input:focus, textarea:focus {
  border-color: #000;
}


textarea {
  vertical-align: top;
  height: 5em;
}

.button {
  padding-left: 0px;
  padding-right: 0px;
  padding-top: 0px;
  padding-bottom: 0px;
}

button {
  margin: auto;
  line-height: 0px;
  height: 50px;
  width:310px;
}

#by_map {
  position: absolute;
  top: 375px;
  left: 10px;
  z-index: 99;
}

    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
    var map;
    var markersArr = [];
    var infoWindow;
        function initMap()
        {
          map = new google.maps.Map(document.getElementById('map'),
          {
            center: new google.maps.LatLng(20, 0),
            zoom: 2,
            disableDefaultUI: true
          });
          infoWindow = new google.maps.InfoWindow;

          /*downloadUrl('http://localhost/wp-content/plugins/map-integration/outputXML.php', function(data)
          {
            var xml = data.responseXML;
            markers = xml.documentElement.getElementsByTagName('marker');
            Array.prototype.forEach.call(markers, function(markerElem)
            {

              var id = markerElem.getAttribute('id');
              var name = markerElem.getAttribute('name');
              var point = new google.maps.LatLng(
                  parseFloat(markerElem.getAttribute('lat')),
                  parseFloat(markerElem.getAttribute('lng')));

              var infowincontent = document.createElement('div');
              var strong = document.createElement('strong');
              strong.textContent = name
              infowincontent.appendChild(strong);
              infowincontent.appendChild(document.createElement('br'));

              var marker = new google.maps.Marker
              ({
                map: map,
                position: point,
              });
              markersArr.push(marker);
              marker.addListener('click', function()
              {
                infoWindow.setContent(infowincontent);
                infoWindow.open(map, marker);
              });
            });
          });*/
        }

      function downloadUrl(url, callback)
      {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function()
        {
          if (request.readyState == 4)
          {
            request.onreadystatechange = doNothing;
            callback(request, request.status);
          }
        };

        request.open('GET', url, true);
        request.send(null);
      }

      function doNothing() {}

      function setMapOnAll(map) {
        for (var i = 0; i < markersArr.length; i++) {
          markersArr[i].setMap(map);
        }
      }

      function deleteMarkers() {
        setMapOnAll(null);
        markersArr = [];
      }


      function checkCoords(point1, point2, lat, lng)
      {
        if(point1[0] == "" ||  point1[1] == "" ||  point2[0] == "" ||  point2[1] == "") return true;
        if(lat<Math.max(point1[0], point2[0]) && lat>Math.min(point1[0], point2[0]) && lng<Math.max(point1[1], point2[1]) && lng>Math.min(point1[1], point2[1])) return true;
        return false;
      }

      $(document).ready(function(){
        $("#submit").click(function(){
            $.post(
              '/wp-content/plugins/map-integration/outputXML.php',
              $('#filter').serialize(),
              function(data, status){
                deleteMarkers();
                var xml = data
                markers = xml.documentElement.getElementsByTagName('marker');
                Array.prototype.forEach.call(markers, function(markerElem)
                {
                  var id = markerElem.getAttribute('id');
                  var name = markerElem.getAttribute('name');
                  var point = new google.maps.LatLng(
                    parseFloat(markerElem.getAttribute('lat')),
                    parseFloat(markerElem.getAttribute('lng')));

                  var infowincontent = document.createElement('div');
                  var strong = document.createElement('strong');
                  strong.textContent = name;
                  infowincontent.appendChild(strong);
                  infowincontent.appendChild(document.createElement('br'));

                  var marker = new google.maps.Marker
                  ({
                    map: map,
                    position: point,
                  });
                  markersArr.push(marker);
                  marker.addListener('click', function()
                  {
                    infoWindow.setContent(infowincontent);
                    infoWindow.open(map, marker);
                  });
              });
        });
      });
    });



    </script>
<div id="by_map">
    <form name="filter" id="filter" action="/wp-content/plugins/map-integration/outputXML.php" method="GET"  target="dummyframe">
  <div>
    <label for="country">Country:</label>
    <input type="text" id="country" name="city_country">
  </div>
  <div>
    <label for="name">City:</label>
    <input type="text" id="name" name="city_name">
  </div>
  <div>
    <label for="timezone">Timezone:</label>
    <input type="text" id="timezone" name="city_timezone">
  </div>
  <div>
    <label for="lat1">First point latitude:</label>
    <input type="number" step="any" id="lat1" name="city_lat1">
  </div>
  <div>
    <label for="lng1">First point longitude:</label>
    <input type="number" step="any" id="lng1" name="city_lng1">
  </div>
  <div>
    <label for="lat2">Second point latitude:</label>
    <input type="number" step="any" id="lat2" name="city_lat2">
  </div>
  <div>
    <label for="lng2">Second point longitude:</label>
    <input type="number" step="any" id="lng2" name="city_lng2">
  </div>
  <div class="button">
  <button type="button" id="submit">Filter</button>
  </div>
  <div class="button">
  <button type="reset" onclick="deleteMarkers()">Reset</button>
  </div>
  </form>
</div>
  <iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe" style="display:none"></iframe>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoaY4TIlQXDHyd5dkFrM5LLiAy9MqZMAA&callback=initMap">
    </script>
  </body>
</html>
